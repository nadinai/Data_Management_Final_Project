---
title: "Populations of concern in Europe. The European refugee crisis in numbers"
author: "Debora Ferreira, Nadina Iacob"
date: "December 14, 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, error=FALSE, warning=FALSE, message=FALSE, cache=FALSE, results=FALSE, comment=FALSE)
library(tidyverse)
library(stringr)
library(dbplyr)
library(DBI)
library(RSQLite)
library(rvest)
library(knitr)
library(rworldmap)
library(ggthemes)
library(yaml)
``` 

## 1. Purpose

This paper aims to use data available on the populations of concern (refugees, asylum seekers, stateless persons, etc.) around the word in order to better understand the refugee crisis experienced in Europe in 2015. We are particularly interested in analyzing the situation before and during this period, to better comprehend the magnitude of the crisis and the characteristics of the populations of concern spread among the European countries. We will also perform comparisons between Europe and other continents to evaluate if this is a regional phenomenon or a global experience. Lastly, we intend to assess some popular statements on refugees, checking if they hold against the analyzed data or not.

## 2. Descriptive Statistics
### 2.1. The data frames

This project was developed using data from the UNHCR, the UN Refugee Agency, on migration trends. The population statistics made available by this office include 6 datasets, which are described as following by the institution[^1]:

|  Data frame | Description                                                                        | 
| ----------- | ---------------------------------------------------------------------------------- | 
| pers_concern| Each row of data represents the information about UNHCR's populations of concern for a given year and country of residence and/or origin. In the 2016 data, figures between 1 and 4 have been replaced with an asterisk (*). These represent situations where the figures are being kept confidential to protect the anonymity of individuals. Such figures are not included in any totals. 
| 
| time_series | Each row of data represents the information about UNHCR's populations of concern for a given year and country of residence and/or origin. In the 2016 data, figures between 1 and 4 have been replaced with an asterisk (*). These represent situations where the figures are being kept confidential to protect the anonymity of individuals. Such figures are not included in any totals.
|
| demographics| Information about persons of concern broken down by sex and age, as well as by location within the country of residence (where such information is available). Note that data broken down in this way is not always available, so it may not be possible to reconcile the figures on this page with those on the Persons of Concern and Time Series pages. Such data is available since 2000.
|
| asylum_all  | Information about asylum applications in a given year and the progress of asylum-seekers through the refugee status determination process. Such data is available since 2000.
|
| asylum_month| Information about asylum applications lodged in 38 European and 6 non-European countries. Data are broken down by month and origin. Where possible, figures exclude repeat/re-opened asylum applications and applications lodged on appeal or with courts. For some countries, the monthly data are available since 1999 while for others at a later period. In the 2016 and 2017 data, figures between 1 and 4 have been replaced with an asterisk (*). These represent situations where figures are being kept confidential to protect the anonymity of individuals. Such figures are not included in any totals. Due to retroactive adjustments implemented by States, totals in this dataset may differ from annual totals published by the competent national authorities.
|
| ressettlement| Information on resettlement arrivals of refugees, with or without UNHCR assistance. This dataset is based on Government statistics and, in principle, excludes humanitarian admissions. In the 2016 data, figures between 1 and 4 have been replaced with an asterisk (*). These represent situations where the figures are being kept confidential to protect the anonymity of individuals. Such figures are not included in any totals.|

[^1]: information obtanined at http://popstats.unhcr.org/en/overview

These datasets were downloaded and opened in the same database for the beginning of the project, already excluding the missing values informed by the UNCHR (*). It was also necessary to tidy the data from "demographics", as the age categories per gender were distributed in different columns and, according to tidy data principles, each variable must form a column. The tidy data frame was named "demo_tidy".[^2]

[^2]: For a more detailed explanation on the tidying process, please see Apendix I.

```{r, include=FALSE}

# Reading the data  

asylum_all <- read.csv("data/unhcr_popstats_export_asylum_seekers_all_data.csv",
                       skip = 4,stringsAsFactors = FALSE)
time_series <- read.csv("data/unhcr_popstats_export_time_series_all_data.csv", 
                        skip = 3, stringsAsFactors = FALSE, na.strings = "*")
pers_concern <- read.csv("data/unhcr_popstats_export_persons_of_concern_all_data.csv",
                         skip = 3, stringsAsFactors = FALSE, na.strings = "*")
asylum_month <- read.csv("data/unhcr_popstats_export_asylum_seekers_monthly_all_data.csv", 
                         skip = 3, stringsAsFactors = FALSE, na.strings = "*")
demographics <- read.csv("data/unhcr_popstats_export_demographics_all_data.csv", 
                         skip = 3, stringsAsFactors = FALSE)
resettlement <- read.csv("data/unhcr_popstats_export_resettlement_all_data.csv",
                         skip = 3, stringsAsFactors = FALSE, na.strings = "*")

# Integrating the 5 tables into a databse  

unhcr <- dbConnect(SQLite(), dbname = "data/UNHRC.sqlite")
dbWriteTable(unhcr, "asylum_all", asylum_all, overwrite=TRUE)
dbWriteTable(unhcr, "asylum_month", asylum_month, overwrite=TRUE)
dbWriteTable(unhcr, "demographics", demographics, overwrite=TRUE)
dbWriteTable(unhcr, "resettlement", resettlement, overwrite=TRUE)
dbWriteTable(unhcr, "time_series", time_series, overwrite=TRUE)
dbWriteTable(unhcr, "pers_concern", pers_concern, overwrite=TRUE)
dbListTables(unhcr)

# Tidying the demographics data frame: creating a column for age and one for gender, 
# ensuring the format is consistent, and changing column names. 

demo_tidy <- 
  demographics %>% 
  select(-F..Total, -M..Total) %>% 
  gather(key = gender_age, value = value,
         -Location.Name,-Country...territory.of.asylum.residence, -Year) %>% 
  separate(col=gender_age, into=c("gender", "age"), sep="\\.", extra = "merge") %>% 
  rename(country_res=Country...territory.of.asylum.residence, 
         location_asylum_residence=Location.Name, year=Year)
demo_tidy$age <- str_replace_all(demo_tidy$age, "\\.", "-")
demo_tidy$age <- str_replace_all(demo_tidy$age, "-$|^-", "")
demo_tidy$age <- str_replace_all(demo_tidy$age, "60", "over 60")

demo_tidy$value <- as.integer(demo_tidy$value)

```

After analyzing the datasets, it was possible to see that "pers_concern" and "time_series" contained equal information; thus, only "time_series" was kept for the present analysis, as it was the tidiest dataset. It was also possible to observe that the "resettlement" dataset could be merged with "time_series", by adding the resettled persons as a new category of populations of concern (variable "Population.type") in the latter dataset. The new tidy data frame was named "pop_time". Once the datasets were merged, the variables' names were unified to easy the future work and understanding.[^3]

[^3]: For a more detailed explanation on the variables used, please see Apendix II.

```{r, include=FALSE}

# Merging "time_series" and "resettlement"
  
resettlement$Population.type <- rep("Resettled",nrow(resettlement))
pop_time <- rbind(time_series, resettlement)

# To check if the two data frames were joined correctly, we performed a count of the observations
# contained in the unmerged data frame and in the merged one, and checked the unique values of the 
# variable "Population.type" in the merged dataframe to see if it included the new category "Ressettled":

sum(nrow(resettlement), nrow(time_series))==nrow(pop_time)
unique(pop_time$Population.type)

# Changing the names of the variables in the merged data frame "pop_time".

pop_time <- pop_time %>% 
  rename(country_res=Country...territory.of.asylum.residence, 
         year=Year, pop_type=Population.type, origin=Origin, value=Value)

```

A similar operation could not, however, be carried out with the "demo_tidy" data frame. The data frames "pop_time" and the "demo_tidy" do not have identification numbers for the respondents/observations and  include different key variables. More specifically, "pop_time" contains the types of populations of concern by country of origin and country of residence, whereas "demo_tidy" does not contain a breakdown of its values by country of origin or type of population of concern, only providing information about the sex and age for the sum of the populations of concern located in a given country of residence, regardless of type or origin. Therefore, merging these data frames would result in losing information.

As the present analysis intends to investigate the evolution of populations of concern over time, also considering the relevance of the demographic information for it, this work will focus on the data frame containing the tidy demographic data ("demo_Tidy") and on the merged time series data frame ("pop_time"). Firstly, "pop_time" will be used to draw conclusions about the populations of concern and their preferred destinations over time. Secondly, "demo_tidy" will help to establish the demographic composition of the overall populations of concern in their different places of residence. At principle, the status of the asylum requests in total and per months were not considered relevant, hence the disregard of the other datasets available.

```{r, include=FALSE}

summary(pop_time) 
summary(demo_tidy)
# The variables "origin" and "pop_type" don't exist in the data frame "demo_tidy".
# The variables "gender", "age" and "location_asylum_residence" don't exist in the data frame "pop_time".

unique(demo_tidy$year)
unique(pop_time$Year)
# We only have information about the demographics (of asylum seekers) from 2001, 
# while the information about persons of concern started being collected since 1951.
# There are no missing years from 2001 to 2016 in both data frames.

unique(demo_tidy$country_res)
# 191 countries, no missing values

# Adjusting some country names that are mixed with characters that are not properly read:
demo_tidy$country_res <- as.character(demo_tidy$country_res)
demo_tidy$country_res[demo_tidy$country_res=="CÃ´te d'Ivoire"] <- "Ivory Coast"
demo_tidy$country_res[demo_tidy$country_res=="CuraÃ§ao"] <- "Curacao"
demo_tidy$country_res[demo_tidy$country_res=="Serbia and Kosovo (S/RES/1244 (1999))"] <- "Serbia and Kosovo"
 
unique(pop_time$country_res) 
#199 countries, no missing values

# Adjusting some country names that are mixed with characters that are not properly read:
pop_time$country_res <- as.character(pop_time$country_res)
pop_time$country_res[pop_time$country_res=="CÃ´te d'Ivoire"] <- "Ivory Coast"
pop_time$country_res[pop_time$country_res=="CuraÃ§ao"] <- "Curacao"
pop_time$country_res[pop_time$country_res=="Serbia and Kosovo (S/RES/1244 (1999))"] <- "Serbia and Kosovo"

unique(pop_time$origin)
# Missing values are coded as "Various/unknown".
# We opt for not recoding these missing values as "NA",
# because using any command to authomatically remove "NA's" 
# could result in missing relevant information.

unique(pop_time$pop_type) 
# "[5] Others of concern" is not specific, but also not a missing value,
# so we kept it in the data frame.

unique(pop_time$value) 
# Values range from 10480 Levels: 
# -1 * 0 1 10 100 1000 10000 100000 1000000 100003 100027 10005 1001 10010 10011 10013 1002 ... 9999
# We let "-1" for lack of information about it (maybe a correction on previous years?)
# "*" is already being read as a missibg value.
              
unique(demo_tidy$location_asylum_residence) 
# This identified no missing values.
# Looking at the data frame, we saw that the missing values are blank,
# we the recoded them as "NA":
demo_tidy$location_asylum_residence[demo_tidy$location_asylum_residence==''] <- NA
# Results could be seen on the dataframe

unique(demo_tidy$gender) 
# Female, Male, F and M, no missing values.
# Standardizing the observations:
demo_tidy$gender[demo_tidy$gender=='F'] <- "Female"
demo_tidy$gender[demo_tidy$gender=='M'] <- "Male"
unique(demo_tidy$gender)

unique(demo_tidy$age) 
# Missing values are coded as "Unknwon".
# Recoding the missing values as "NA":
demo_tidy$age[demo_tidy$age=='Unknown'] <- NA
demo_tidy$age

unique(demo_tidy$value)
# Missing values already coded as "NA"

```

### 2.2. Key variables of interest created/modified

After the data frames of interest were treated, having their missing values recoded, it was necessary to create a new variable in each of them that would reflect the continents in which the populations of concern were living (i.e. the continents of destiny of the migrants). This new variable, called "continent_res", is fundamentallly related to the purpose of the paper of analyzing an event (migrant crisis) that was reportedly more expressive in Europe, and also extensively debated in the media and politics of this continent.

```{r, include=FALSE}

# NEW VARIABLE FOR CONTINENT

# In the in the data frame "pop_time"

# To discover which and how countries were listed by the UN
unique(pop_time$country_res)

# Creating the new variable "continent_res" 
# by assigning each country to its respective continent

attach(pop_time)

pop_time$continent_res[country_res=='Austria'] <- "Europe"
pop_time$continent_res[country_res=='Belgium'] <- "Europe"
pop_time$continent_res[country_res=='Switzerland'] <- "Europe"
pop_time$continent_res[country_res=='Germany'] <- "Europe"
pop_time$continent_res[country_res=='Denmark'] <- "Europe"
pop_time$continent_res[country_res=='Spain'] <- "Europe"
pop_time$continent_res[country_res=='France'] <- "Europe"
pop_time$continent_res[country_res=='United Kingdom'] <- "Europe"
pop_time$continent_res[country_res=='Greece'] <- "Europe"
pop_time$continent_res[country_res=='Italy'] <- "Europe"
pop_time$continent_res[country_res=='Luxembourg'] <- "Europe"
pop_time$continent_res[country_res=='Netherlands'] <- "Europe"
pop_time$continent_res[country_res=='Norway'] <- "Europe"
pop_time$continent_res[country_res=='Sweden'] <- "Europe"
pop_time$continent_res[country_res=='Serbia and Kosovo (S/RES/1244 (1999))'] <- "Europe"
pop_time$continent_res[country_res=='Cyprus'] <- "Europe"
pop_time$continent_res[country_res=='Portugal'] <- "Europe"
pop_time$continent_res[country_res=='Romania'] <- "Europe"
pop_time$continent_res[country_res=='Finland'] <- "Europe"
pop_time$continent_res[country_res=='Ireland'] <- "Europe"
pop_time$continent_res[country_res=='Hungary'] <- "Europe"
pop_time$continent_res[country_res=='Iceland'] <- "Europe"
pop_time$continent_res[country_res=='Poland'] <- "Europe"
pop_time$continent_res[country_res=='Czech Rep.'] <- "Europe"
pop_time$continent_res[country_res=='Croatia'] <- "Europe"
pop_time$continent_res[country_res=='Bulgaria'] <- "Europe"
pop_time$continent_res[country_res=='Albania'] <- "Europe"
pop_time$continent_res[country_res=='The former Yugoslav Republic of Macedonia'] <- "Europe"
pop_time$continent_res[country_res=='Slovenia'] <- "Europe"
pop_time$continent_res[country_res=='Bosnia and Herzegovina'] <- "Europe"
pop_time$continent_res[country_res=='Georgia'] <- "Europe"
pop_time$continent_res[country_res=='Malta'] <- "Europe"
pop_time$continent_res[country_res=='Slovakia'] <- "Europe"
pop_time$continent_res[country_res=='Belarus'] <- "Europe"
pop_time$continent_res[country_res=='Ukraine'] <- "Europe"
pop_time$continent_res[country_res=='Lithuania'] <- "Europe"
pop_time$continent_res[country_res=='Latvia'] <- "Europe"
pop_time$continent_res[country_res=='Rep. of Moldova'] <- "Europe"
pop_time$continent_res[country_res=='Estonia'] <- "Europe"
pop_time$continent_res[country_res=='Liechtenstein'] <- "Europe"
pop_time$continent_res[country_res=='Montenegro'] <- "Europe"
pop_time$continent_res[country_res=='Monaco'] <- "Europe"

pop_time$continent_res[country_res=='Canada'] <- "Americas"
pop_time$continent_res[country_res=='United States of America'] <- "Americas"
pop_time$continent_res[country_res=='Argentina'] <- "Americas"
pop_time$continent_res[country_res=='Brazil'] <- "Americas"
pop_time$continent_res[country_res=='Chile'] <- "Americas"
pop_time$continent_res[country_res=='Paraguay'] <- "Americas"
pop_time$continent_res[country_res=='Venezuela (Bolivarian Republic of)'] <- "Americas"
pop_time$continent_res[country_res=='Colombia'] <- "Americas"
pop_time$continent_res[country_res=='Dominican Rep.'] <- "Americas"
pop_time$continent_res[country_res=='Mexico'] <- "Americas"
pop_time$continent_res[country_res=='Peru'] <- "Americas"
pop_time$continent_res[country_res=='Uruguay'] <- "Americas"
pop_time$continent_res[country_res=='Bolivia (Plurinational State of)'] <- "Americas"
pop_time$continent_res[country_res=='Costa Rica'] <- "Americas"
pop_time$continent_res[country_res=='Ecuador'] <- "Americas"                                  
pop_time$continent_res[country_res=='Guatemala'] <- "Americas"
pop_time$continent_res[country_res=='Guyana'] <- "Americas"
pop_time$continent_res[country_res=='Honduras'] <- "Americas"
pop_time$continent_res[country_res=='Nicaragua'] <- "Americas"
pop_time$continent_res[country_res=='Panama'] <- "Americas"
pop_time$continent_res[country_res=='El Salvador'] <- "Americas"
pop_time$continent_res[country_res=='Cuba'] <- "Americas"
pop_time$continent_res[country_res=='Belize'] <- "Americas"
pop_time$continent_res[country_res=='French Guiana'] <- "Americas"
pop_time$continent_res[country_res=='Jamaica'] <- "Americas"
pop_time$continent_res[country_res=='Bahamas']<- "Americas"
pop_time$continent_res[country_res=='Suriname']<- "Americas"
pop_time$continent_res[country_res=='Saint Lucia']<- "Americas"
pop_time$continent_res[country_res=='Haiti']<- "Americas"
pop_time$continent_res[country_res=='Antigua and Barbuda']<- "Americas"
pop_time$continent_res[country_res=='Trinidad and Tobago']<- "Americas"
pop_time$continent_res[country_res=='Saint Kitts and Nevis']<- "Americas"
pop_time$continent_res[country_res=='Saint Vincent and the Grenadines']<- "Americas"
pop_time$continent_res[country_res=='Cayman Islands']<- "Americas"
pop_time$continent_res[country_res=='Aruba']<- "Americas"
pop_time$continent_res[country_res=='British Virgin Islands']<- "Americas"
pop_time$continent_res[country_res=='Bonaire']<- "Americas"
pop_time$continent_res[country_res=='CuraÃ§ao']<- "Americas"
pop_time$continent_res[country_res=='Grenada'] <- "Americas"
pop_time$continent_res[country_res=='Montserrat'] <- "Americas"
pop_time$continent_res[country_res=='Sint Maarten (Dutch part)'] <- "Americas"
pop_time$continent_res[country_res=='Anguilla'] <- "Americas"
pop_time$continent_res[country_res=='Turks and Caicos Islands'] <- "Americas"

pop_time$continent_res[country_res=='Morocco'] <- "Africa"
pop_time$continent_res[country_res=='Tunisia'] <- "Africa"
pop_time$continent_res[country_res=='Dem. Rep. of the Congo'] <- "Africa"
pop_time$continent_res[country_res=='Burundi'] <- "Africa"
pop_time$continent_res[country_res=='Togo'] <- "Africa"
pop_time$continent_res[country_res=='United Rep. of Tanzania'] <- "Africa"
pop_time$continent_res[country_res=='Uganda'] <- "Africa"
pop_time$continent_res[country_res=='Senegal'] <- "Africa"
pop_time$continent_res[country_res=='Central African Rep.'] <- "Africa"
pop_time$continent_res[country_res=='Egypt'] <- "Africa"
pop_time$continent_res[country_res=='Rwanda'] <- "Africa"
pop_time$continent_res[country_res=='Zambia'] <- "Africa"
pop_time$continent_res[country_res=='Sudan'] <- "Africa"
pop_time$continent_res[country_res=='Botswana'] <- "Africa"
pop_time$continent_res[country_res=='Ethiopia'] <- "Africa"
pop_time$continent_res[country_res=='Equatorial Guinea'] <- "Africa"
pop_time$continent_res[country_res=='Benin'] <- "Africa"
pop_time$continent_res[country_res=='Congo'] <- "Africa"                         
pop_time$continent_res[country_res=='Gabon'] <- "Africa"                                    
pop_time$continent_res[country_res=='Ghana'] <- "Africa"                                     
pop_time$continent_res[country_res=='Liberia'] <- "Africa"
pop_time$continent_res[country_res=='Sierra Leone'] <- "Africa"
pop_time$continent_res[country_res=='Cameroon'] <- "Africa"
pop_time$continent_res[country_res=='Algeria'] <- "Africa"
pop_time$continent_res[country_res=='Kenya'] <- "Africa"
pop_time$continent_res[country_res=='Lesotho'] <- "Africa"
pop_time$continent_res[country_res=='Swaziland'] <- "Africa"
pop_time$continent_res[country_res=='Mali'] <- "Africa"
pop_time$continent_res[country_res=='Gambia'] <- "Africa"
pop_time$continent_res[country_res=='Mozambique'] <- "Africa"
pop_time$continent_res[country_res=='Angola'] <- "Africa"
pop_time$continent_res[country_res=='Nigeria'] <- "Africa"
pop_time$continent_res[country_res=='Djibouti'] <- "Africa"
pop_time$continent_res[country_res=='Niger'] <- "Africa"
pop_time$continent_res[country_res=='Somalia'] <- "Africa"
pop_time$continent_res[country_res=='Zimbabwe'] <- "Africa"
pop_time$continent_res[country_res=='Guinea-Bissau'] <- "Africa"
pop_time$continent_res[country_res=='Burkina Faso'] <- "Africa"
pop_time$continent_res[country_res=='Malawi'] <- "Africa"
pop_time$continent_res[country_res=='Mauritania'] <- "Africa"
pop_time$continent_res[country_res=='Comoros'] <- "Africa"
pop_time$continent_res[country_res=='Guinea'] <- "Africa"
pop_time$continent_res[country_res=='Cabo Verde'] <- "Africa"
pop_time$continent_res[country_res=='Namibia'] <- "Africa"
pop_time$continent_res[country_res=='Chad'] <- "Africa"
pop_time$continent_res[country_res=='Eritrea'] <- "Africa"
pop_time$continent_res[country_res=='Libya'] <- "Africa"
pop_time$continent_res[country_res=='South Africa'] <- "Africa"
pop_time$continent_res[country_res=='Madagascar'] <- "Africa"
pop_time$continent_res[country_res=='Mauritius'] <- "Africa"
pop_time$continent_res[country_res=='South Sudan'] <- "Africa"
pop_time$continent_res[country_res=='Barbados'] <- "Africa"
pop_time$continent_res[country_res=='Seychelles'] <- "Africa"
pop_time$continent_res[country_res=="CÃ´te d'Ivoire"] <- "Africa"

pop_time$continent_res[country_res=='China'] <- "Asia"
pop_time$continent_res[country_res=='Hong Kong SAR'] <- "Asia"
pop_time$continent_res[country_res=='China, Hong Kong SAR'] <- "Asia"                   
pop_time$continent_res[country_res=='China, Macao SAR'] <- "Asia" 
pop_time$continent_res[country_res=='Turkey'] <- "Asia"
pop_time$continent_res[country_res=='Iran (Islamic Rep. of)'] <- "Asia" 
pop_time$continent_res[country_res=='India'] <- "Asia"
pop_time$continent_res[country_res=='Cambodia'] <- "Asia"
pop_time$continent_res[country_res=='Lebanon'] <- "Asia"
pop_time$continent_res[country_res=='Macao SAR'] <- "Asia"
pop_time$continent_res[country_res=='Nepal'] <- "Asia"
pop_time$continent_res[country_res=='Bhutan'] <- "Asia"
pop_time$continent_res[country_res=='United Arab Emirates'] <- "Asia" 
pop_time$continent_res[country_res=='Jordan'] <- "Asia"
pop_time$continent_res[country_res=='Viet Nam'] <- "Asia"
pop_time$continent_res[country_res=='Bangladesh'] <- "Asia"
pop_time$continent_res[country_res=='Bahrain'] <- "Asia"
pop_time$continent_res[country_res=='Saudi Arabia'] <- "Asia"
pop_time$continent_res[country_res=='Philippines'] <- "Asia"
pop_time$continent_res[country_res=='Thailand'] <- "Asia"
pop_time$continent_res[country_res=='Yemen'] <- "Asia"
pop_time$continent_res[country_res=='Rep. of Korea'] <- "Asia"
pop_time$continent_res[country_res=='Indonesia'] <- "Asia"
pop_time$continent_res[country_res=='Singapore'] <- "Asia"
pop_time$continent_res[country_res=='Iraq'] <- "Asia"
pop_time$continent_res[country_res=='Pakistan'] <- "Asia"
pop_time$continent_res[country_res=='Qatar'] <- "Asia"
pop_time$continent_res[country_res=='Syrian Arab Rep.'] <- "Asia"
pop_time$continent_res[country_res=='Kuwait'] <- "Asia"
pop_time$continent_res[country_res=='Afghanistan'] <- "Asia"
pop_time$continent_res[country_res=='Sri Lanka'] <- "Asia"
pop_time$continent_res[country_res=='Armenia'] <- "Asia"
pop_time$continent_res[country_res=='Azerbaijan'] <- "Asia"
pop_time$continent_res[country_res=='Tajikistan'] <- "Asia"
pop_time$continent_res[country_res=='Kazakhstan'] <- "Asia"
pop_time$continent_res[country_res=='Japan'] <- "Asia"
pop_time$continent_res[country_res=='Malaysia'] <- "Asia"
pop_time$continent_res[country_res=='Kyrgyzstan'] <- "Asia"
pop_time$continent_res[country_res=='Russian Federation'] <- "Asia"
pop_time$continent_res[country_res=='Turkmenistan'] <- "Asia"
pop_time$continent_res[country_res=='Uzbekistan'] <- "Asia"
pop_time$continent_res[country_res=='Israel'] <- "Asia"
pop_time$continent_res[country_res=='Oman'] <- "Asia"
pop_time$continent_res[country_res=='State of Palestine'] <- "Asia"
pop_time$continent_res[country_res=='Timor-Leste'] <- "Asia"
pop_time$continent_res[country_res=='Myanmar'] <- "Asia"
pop_time$continent_res[country_res=='Mongolia'] <- "Asia"
pop_time$continent_res[country_res=='Brunei Darussalam'] <- "Asia"
pop_time$continent_res[country_res=="Dem. People's Rep. of Korea"] <- "Asia"
pop_time$continent_res[country_res=="Lao People's Dem. Rep."] <- "Asia"

pop_time$continent_res[country_res=='Australia'] <- "Oceania"
pop_time$continent_res[country_res=='New Zealand'] <- "Oceania"
pop_time$continent_res[country_res=='Papua New Guinea'] <- "Oceania"
pop_time$continent_res[country_res=='Fiji'] <- "Oceania"
pop_time$continent_res[country_res=='Vanuatu'] <- "Oceania"
pop_time$continent_res[country_res=='Solomon Islands'] <- "Oceania"
pop_time$continent_res[country_res=='Micronesia (Federated States of)'] <- "Oceania"
pop_time$continent_res[country_res=='Palau'] <- "Oceania"
pop_time$continent_res[country_res=='Samoa'] <- "Oceania"
pop_time$continent_res[country_res=='Tonga'] <- "Oceania"
pop_time$continent_res[country_res=='Nauru'] <- "Oceania"

detach(pop_time)

# To check if all the countries were included
unique(pop_time$continent_res) 

# To change the order of the columns and put continent before country
pop_time<-pop_time[,c(1,6,2,3,4,5)]
head(pop_time)

# In the in the data frame "demo_tidy"

# We use unique() to discover which and how countries are listed in the demo_tidy dataframe
unique(demo_tidy$country_res) 

# To compare the countries from the dataframe "pop_time" and "demo_tidy"
unique(pop_time[!pop_time$country_res %in% demo_tidy$country_res,]) 

# "demo_tidy" has 8 countries less than "pop_time", so we can use the same coding as before
               
# Creating the new variable "continent_res"
# by assigning each country to its respective continent

attach(demo_tidy)

demo_tidy$continent_res[country_res=='Austria'] <- "Europe"
demo_tidy$continent_res[country_res=='Belgium'] <- "Europe"
demo_tidy$continent_res[country_res=='Switzerland'] <- "Europe"
demo_tidy$continent_res[country_res=='Germany'] <- "Europe"
demo_tidy$continent_res[country_res=='Denmark'] <- "Europe"
demo_tidy$continent_res[country_res=='Spain'] <- "Europe"
demo_tidy$continent_res[country_res=='France'] <- "Europe"
demo_tidy$continent_res[country_res=='United Kingdom'] <- "Europe"
demo_tidy$continent_res[country_res=='Greece'] <- "Europe"
demo_tidy$continent_res[country_res=='Italy'] <- "Europe"
demo_tidy$continent_res[country_res=='Luxembourg'] <- "Europe"
demo_tidy$continent_res[country_res=='Netherlands'] <- "Europe"
demo_tidy$continent_res[country_res=='Norway'] <- "Europe"
demo_tidy$continent_res[country_res=='Sweden'] <- "Europe"
demo_tidy$continent_res[country_res=='Serbia and Kosovo (S/RES/1244 (1999))'] <- "Europe"
demo_tidy$continent_res[country_res=='Cyprus'] <- "Europe"
demo_tidy$continent_res[country_res=='Portugal'] <- "Europe"
demo_tidy$continent_res[country_res=='Romania'] <- "Europe"
demo_tidy$continent_res[country_res=='Finland'] <- "Europe"
demo_tidy$continent_res[country_res=='Ireland'] <- "Europe"
demo_tidy$continent_res[country_res=='Hungary'] <- "Europe"
demo_tidy$continent_res[country_res=='Iceland'] <- "Europe"
demo_tidy$continent_res[country_res=='Poland'] <- "Europe"
demo_tidy$continent_res[country_res=='Czech Rep.'] <- "Europe"
demo_tidy$continent_res[country_res=='Croatia'] <- "Europe"
demo_tidy$continent_res[country_res=='Bulgaria'] <- "Europe"
demo_tidy$continent_res[country_res=='Albania'] <- "Europe"
demo_tidy$continent_res[country_res=='The former Yugoslav Republic of Macedonia'] <- "Europe"
demo_tidy$continent_res[country_res=='Slovenia'] <- "Europe"
demo_tidy$continent_res[country_res=='Bosnia and Herzegovina'] <- "Europe"
demo_tidy$continent_res[country_res=='Georgia'] <- "Europe"
demo_tidy$continent_res[country_res=='Malta'] <- "Europe"
demo_tidy$continent_res[country_res=='Slovakia'] <- "Europe"
demo_tidy$continent_res[country_res=='Belarus'] <- "Europe"
demo_tidy$continent_res[country_res=='Ukraine'] <- "Europe"
demo_tidy$continent_res[country_res=='Lithuania'] <- "Europe"
demo_tidy$continent_res[country_res=='Latvia'] <- "Europe"
demo_tidy$continent_res[country_res=='Rep. of Moldova'] <- "Europe"
demo_tidy$continent_res[country_res=='Estonia'] <- "Europe"
demo_tidy$continent_res[country_res=='Liechtenstein'] <- "Europe"
demo_tidy$continent_res[country_res=='Montenegro'] <- "Europe"
demo_tidy$continent_res[country_res=='Monaco'] <- "Europe"

demo_tidy$continent_res[country_res=='Canada'] <- "Americas"
demo_tidy$continent_res[country_res=='United States of America'] <- "Americas"
demo_tidy$continent_res[country_res=='Argentina'] <- "Americas"
demo_tidy$continent_res[country_res=='Brazil'] <- "Americas"
demo_tidy$continent_res[country_res=='Chile'] <- "Americas"
demo_tidy$continent_res[country_res=='Paraguay'] <- "Americas"
demo_tidy$continent_res[country_res=='Venezuela (Bolivarian Republic of)'] <- "Americas"
demo_tidy$continent_res[country_res=='Colombia'] <- "Americas"
demo_tidy$continent_res[country_res=='Dominican Rep.'] <- "Americas"
demo_tidy$continent_res[country_res=='Mexico'] <- "Americas"
demo_tidy$continent_res[country_res=='Peru'] <- "Americas"
demo_tidy$continent_res[country_res=='Uruguay'] <- "Americas"
demo_tidy$continent_res[country_res=='Bolivia (Plurinational State of)'] <- "Americas"
demo_tidy$continent_res[country_res=='Costa Rica'] <- "Americas"
demo_tidy$continent_res[country_res=='Ecuador'] <- "Americas"                                  
demo_tidy$continent_res[country_res=='Guatemala'] <- "Americas"
demo_tidy$continent_res[country_res=='Guyana'] <- "Americas"
demo_tidy$continent_res[country_res=='Honduras'] <- "Americas"
demo_tidy$continent_res[country_res=='Nicaragua'] <- "Americas"
demo_tidy$continent_res[country_res=='Panama'] <- "Americas"
demo_tidy$continent_res[country_res=='El Salvador'] <- "Americas"
demo_tidy$continent_res[country_res=='Cuba'] <- "Americas"
demo_tidy$continent_res[country_res=='Belize'] <- "Americas"
demo_tidy$continent_res[country_res=='French Guiana'] <- "Americas"
demo_tidy$continent_res[country_res=='Jamaica'] <- "Americas"
demo_tidy$continent_res[country_res=='Bahamas']<- "Americas"
demo_tidy$continent_res[country_res=='Suriname']<- "Americas"
demo_tidy$continent_res[country_res=='Saint Lucia']<- "Americas"
demo_tidy$continent_res[country_res=='Haiti']<- "Americas"
demo_tidy$continent_res[country_res=='Antigua and Barbuda']<- "Americas"
demo_tidy$continent_res[country_res=='Trinidad and Tobago']<- "Americas"
demo_tidy$continent_res[country_res=='Saint Kitts and Nevis']<- "Americas"
demo_tidy$continent_res[country_res=='Saint Vincent and the Grenadines']<- "Americas"
demo_tidy$continent_res[country_res=='Cayman Islands']<- "Americas"
demo_tidy$continent_res[country_res=='Aruba']<- "Americas"
demo_tidy$continent_res[country_res=='British Virgin Islands']<- "Americas"
demo_tidy$continent_res[country_res=='Bonaire']<- "Americas"
demo_tidy$continent_res[country_res=='CuraÃ§ao']<- "Americas"
demo_tidy$continent_res[country_res=='Grenada'] <- "Americas"
demo_tidy$continent_res[country_res=='Montserrat'] <- "Americas"
demo_tidy$continent_res[country_res=='Sint Maarten (Dutch part)'] <- "Americas"
demo_tidy$continent_res[country_res=='Anguilla'] <- "Americas"
demo_tidy$continent_res[country_res=='Turks and Caicos Islands'] <- "Americas"

demo_tidy$continent_res[country_res=='Morocco'] <- "Africa"
demo_tidy$continent_res[country_res=='Tunisia'] <- "Africa"
demo_tidy$continent_res[country_res=='Dem. Rep. of the Congo'] <- "Africa"
demo_tidy$continent_res[country_res=='Burundi'] <- "Africa"
demo_tidy$continent_res[country_res=='Togo'] <- "Africa"
demo_tidy$continent_res[country_res=='United Rep. of Tanzania'] <- "Africa"
demo_tidy$continent_res[country_res=='Uganda'] <- "Africa"
demo_tidy$continent_res[country_res=='Senegal'] <- "Africa"
demo_tidy$continent_res[country_res=='Central African Rep.'] <- "Africa"
demo_tidy$continent_res[country_res=='Egypt'] <- "Africa"
demo_tidy$continent_res[country_res=='Rwanda'] <- "Africa"
demo_tidy$continent_res[country_res=='Zambia'] <- "Africa"
demo_tidy$continent_res[country_res=='Sudan'] <- "Africa"
demo_tidy$continent_res[country_res=='Botswana'] <- "Africa"
demo_tidy$continent_res[country_res=='Ethiopia'] <- "Africa"
demo_tidy$continent_res[country_res=='Equatorial Guinea'] <- "Africa"
demo_tidy$continent_res[country_res=='Benin'] <- "Africa"
demo_tidy$continent_res[country_res=='Congo'] <- "Africa"                         
demo_tidy$continent_res[country_res=='Gabon'] <- "Africa"                                    
demo_tidy$continent_res[country_res=='Ghana'] <- "Africa"                                     
demo_tidy$continent_res[country_res=='Liberia'] <- "Africa"
demo_tidy$continent_res[country_res=='Sierra Leone'] <- "Africa"
demo_tidy$continent_res[country_res=='Cameroon'] <- "Africa"
demo_tidy$continent_res[country_res=='Algeria'] <- "Africa"
demo_tidy$continent_res[country_res=='Kenya'] <- "Africa"
demo_tidy$continent_res[country_res=='Lesotho'] <- "Africa"
demo_tidy$continent_res[country_res=='Swaziland'] <- "Africa"
demo_tidy$continent_res[country_res=='Mali'] <- "Africa"
demo_tidy$continent_res[country_res=='Gambia'] <- "Africa"
demo_tidy$continent_res[country_res=='Mozambique'] <- "Africa"
demo_tidy$continent_res[country_res=='Angola'] <- "Africa"
demo_tidy$continent_res[country_res=='Nigeria'] <- "Africa"
demo_tidy$continent_res[country_res=='Djibouti'] <- "Africa"
demo_tidy$continent_res[country_res=='Niger'] <- "Africa"
demo_tidy$continent_res[country_res=='Somalia'] <- "Africa"
demo_tidy$continent_res[country_res=='Zimbabwe'] <- "Africa"
demo_tidy$continent_res[country_res=='Guinea-Bissau'] <- "Africa"
demo_tidy$continent_res[country_res=='Burkina Faso'] <- "Africa"
demo_tidy$continent_res[country_res=='Malawi'] <- "Africa"
demo_tidy$continent_res[country_res=='Mauritania'] <- "Africa"
demo_tidy$continent_res[country_res=='Comoros'] <- "Africa"
demo_tidy$continent_res[country_res=='Guinea'] <- "Africa"
demo_tidy$continent_res[country_res=='Cabo Verde'] <- "Africa"
demo_tidy$continent_res[country_res=='Namibia'] <- "Africa"
demo_tidy$continent_res[country_res=='Chad'] <- "Africa"
demo_tidy$continent_res[country_res=='Eritrea'] <- "Africa"
demo_tidy$continent_res[country_res=='Libya'] <- "Africa"
demo_tidy$continent_res[country_res=='South Africa'] <- "Africa"
demo_tidy$continent_res[country_res=='Madagascar'] <- "Africa"
demo_tidy$continent_res[country_res=='Mauritius'] <- "Africa"
demo_tidy$continent_res[country_res=='South Sudan'] <- "Africa"
demo_tidy$continent_res[country_res=='Barbados'] <- "Africa"
demo_tidy$continent_res[country_res=='Seychelles'] <- "Africa"
demo_tidy$continent_res[country_res=="CÃ´te d'Ivoire"] <- "Africa"

demo_tidy$continent_res[country_res=='China'] <- "Asia"
demo_tidy$continent_res[country_res=='Hong Kong SAR'] <- "Asia"
demo_tidy$continent_res[country_res=='China, Hong Kong SAR'] <- "Asia"                   
demo_tidy$continent_res[country_res=='China, Macao SAR'] <- "Asia" 
demo_tidy$continent_res[country_res=='Turkey'] <- "Asia"
demo_tidy$continent_res[country_res=='Iran (Islamic Rep. of)'] <- "Asia" 
demo_tidy$continent_res[country_res=='India'] <- "Asia"
demo_tidy$continent_res[country_res=='Cambodia'] <- "Asia"
demo_tidy$continent_res[country_res=='Lebanon'] <- "Asia"
demo_tidy$continent_res[country_res=='Macao SAR'] <- "Asia"
demo_tidy$continent_res[country_res=='Nepal'] <- "Asia"
demo_tidy$continent_res[country_res=='Bhutan'] <- "Asia"
demo_tidy$continent_res[country_res=='United Arab Emirates'] <- "Asia" 
demo_tidy$continent_res[country_res=='Jordan'] <- "Asia"
demo_tidy$continent_res[country_res=='Viet Nam'] <- "Asia"
demo_tidy$continent_res[country_res=='Bangladesh'] <- "Asia"
demo_tidy$continent_res[country_res=='Bahrain'] <- "Asia"
demo_tidy$continent_res[country_res=='Saudi Arabia'] <- "Asia"
demo_tidy$continent_res[country_res=='Philippines'] <- "Asia"
demo_tidy$continent_res[country_res=='Thailand'] <- "Asia"
demo_tidy$continent_res[country_res=='Yemen'] <- "Asia"
demo_tidy$continent_res[country_res=='Rep. of Korea'] <- "Asia"
demo_tidy$continent_res[country_res=='Indonesia'] <- "Asia"
demo_tidy$continent_res[country_res=='Singapore'] <- "Asia"
demo_tidy$continent_res[country_res=='Iraq'] <- "Asia"
demo_tidy$continent_res[country_res=='Pakistan'] <- "Asia"
demo_tidy$continent_res[country_res=='Qatar'] <- "Asia"
demo_tidy$continent_res[country_res=='Syrian Arab Rep.'] <- "Asia"
demo_tidy$continent_res[country_res=='Kuwait'] <- "Asia"
demo_tidy$continent_res[country_res=='Afghanistan'] <- "Asia"
demo_tidy$continent_res[country_res=='Sri Lanka'] <- "Asia"
demo_tidy$continent_res[country_res=='Armenia'] <- "Asia"
demo_tidy$continent_res[country_res=='Azerbaijan'] <- "Asia"
demo_tidy$continent_res[country_res=='Tajikistan'] <- "Asia"
demo_tidy$continent_res[country_res=='Kazakhstan'] <- "Asia"
demo_tidy$continent_res[country_res=='Japan'] <- "Asia"
demo_tidy$continent_res[country_res=='Malaysia'] <- "Asia"
demo_tidy$continent_res[country_res=='Kyrgyzstan'] <- "Asia"
demo_tidy$continent_res[country_res=='Russian Federation'] <- "Asia"
demo_tidy$continent_res[country_res=='Turkmenistan'] <- "Asia"
demo_tidy$continent_res[country_res=='Uzbekistan'] <- "Asia"
demo_tidy$continent_res[country_res=='Israel'] <- "Asia"
demo_tidy$continent_res[country_res=='Oman'] <- "Asia"
demo_tidy$continent_res[country_res=='State of Palestine'] <- "Asia"
demo_tidy$continent_res[country_res=='Timor-Leste'] <- "Asia"
demo_tidy$continent_res[country_res=='Myanmar'] <- "Asia"
demo_tidy$continent_res[country_res=='Mongolia'] <- "Asia"
demo_tidy$continent_res[country_res=='Brunei Darussalam'] <- "Asia"
demo_tidy$continent_res[country_res=="Dem. People's Rep. of Korea"] <- "Asia"
demo_tidy$continent_res[country_res=="Lao People's Dem. Rep."] <- "Asia"

demo_tidy$continent_res[country_res=='Australia'] <- "Oceania"
demo_tidy$continent_res[country_res=='New Zealand'] <- "Oceania"
demo_tidy$continent_res[country_res=='Papua New Guinea'] <- "Oceania"
demo_tidy$continent_res[country_res=='Fiji'] <- "Oceania"
demo_tidy$continent_res[country_res=='Vanuatu'] <- "Oceania"
demo_tidy$continent_res[country_res=='Solomon Islands'] <- "Oceania"
demo_tidy$continent_res[country_res=='Micronesia (Federated States of)'] <- "Oceania"
demo_tidy$continent_res[country_res=='Palau'] <- "Oceania"
demo_tidy$continent_res[country_res=='Samoa'] <- "Oceania"
demo_tidy$continent_res[country_res=='Tonga'] <- "Oceania"
demo_tidy$continent_res[country_res=='Nauru'] <- "Oceania"

detach(demo_tidy)

# To check if all the countries were included
unique(demo_tidy$continent_res) 

# To change the order of the columns and put continent before country
demo_tidy<-demo_tidy[,c(1,7,2,3,4,5,6)]
head(demo_tidy)

```

Lastly, it was noticed that the UNHCR provides inconsistent information over time with regards to the coding of the age groups ("demo_tidy" data frame). From 2001 to 2005, the age group "5-17" was used, whereas from 2006 onwards, this group was split into two: "5-11" and "12-17" years old. As we deemed that, for the purposes of this paper, it would not be necessary to have demographic information on preteens and teenagers separately, the two split categories were unified into "5-17" years old for the entire the data frame. This way, a time series analysis could be conducted for a longer period o time, without discontinuity, which is relevant considering that the time range of this data frame (2001-2016) is already much smaller than the one in "pop_time" (1951-2016). There are also cases where no age was recorded.

```{r, include=FALSE}

# Unifying age categories

demo_tidy$age[demo_tidy$age=="5-11"] <- "5-17"
demo_tidy$age[demo_tidy$age=="12-17"] <- "5-17"
unique(demo_tidy$age)

```

## 3. Methods

As observed, the UNHCR datasets are very limited, there are not enough controlling variables to run a plausible regression model with statistically significant results. Besides, there is relevant information distributed across two data frames which cannot be merged and, despite the amount of observations collected, they are not organized as panel data (there is not even an identification number for each observation). In this context, the only option left was conducting a time series analyses of the UNHCR data.

On a brief explanation, *"Time series analysis is the analysis of a series of data-points over time, allowing one to answer question such as what is the causal effect on a variable Y of a change in variable X over time?"* This will be explored in the following session of the paper.[^4] 

[^4]: Imdadullah (2013). Time Series Analysis and Forecasting. *In: Basic Statistics and Data Analysis.* Available at: http://itfeature.com/time-series-analysis-and-forecasting/time-series-analysis-forecasting. Retrived 14.12.2017.

## 4. Analysis

We started the analysis by taking a global view at the time trends in populations of concern across continents. This resulted in a comparative view of the overall populations of concern situation over the past 30 years. The following graph shows that, in all continents, there has been a steady increase in the number of populations of concern. However, Europe experienced by far the steepest increase, especially during the 2000-2015 period, with the populations of concern reaching over 20 million people at aggregate level in the continent. 

```{r, fig.width = 5, fig.height = 3, fig.align="center"}

# Time trends in refugee waves across continents starting in 1990

pop_time$value <- as.integer(as.factor(pop_time$value))

library(scales)
pop_time %>% 
  filter(year > 1990) %>% 
  na.omit(value) %>% 
  group_by(year, continent_res) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  ggplot(aes(x = year, y = total)) +
  geom_line(aes(colour=continent_res), show.legend = FALSE) +
  ggtitle("Time trends in populations of concern across \n continents from 1990 to 2016") +
  xlab("Year") +
  ylab("Registered populations of concern") +
  theme(plot.title = element_text(size=10, family="Times")) +
  theme_minimal() +
  facet_wrap(~ continent_res, ncol=3) +
  scale_y_continuous(labels = comma)

```

In a next step, this increase was disentangled by the types of populations of concern in the last three decades; the idea was to see which type(s) of population drove this increase the most. We saw that refugees and asylum_seekers were the major populations of concern across all continents and much more preponderant over the other populations of concern when it is about Europe. While the other population types remained quite constant over time, we can affirm that the number of refugees and asylum_seekers was the cause of the increase in the number of persons of concern.

```{r, fig.align="center"}

pop_time$value <- as.integer(as.factor(pop_time$value))

# Time-trends in refugee waves across continents from 1990 to 2016, 
# broken down by type of immigrant

pop_time %>%
  filter(year > 1990) %>% 
  na.omit(value) %>% 
  group_by(continent_res, pop_type, year) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  ggplot(aes(x = year, y = total, color=pop_type)) +
  geom_line(aes(group = pop_type)) +
  ggtitle("Time trends in populations of concern across \n continents from 1990 to 2016 broken down \n by type of population of concern") +
  xlab("Year") +
  ylab("Registered populations of concern") +
  labs(color = "Populations of concern") +
  theme(plot.title = element_text(size=10, family="Times")) +
  theme_minimal() +
  facet_wrap(~ continent_res, ncol=3)

```

```{r, include=FALSE}

# What was the distribution of the populations of concern in 2015 across continents?
# (Excluding Europe, because, as the graphs before have shown, it is an outlier and
# it makes it more difficult to see the subtle differences in the other continents.)

library(scales)
options(scipen=5)
pop_time %>% 
  filter(year==2016, continent_res != "Europe") %>% 
  na.omit(value) %>%  
  group_by(year, continent_res, pop_type) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  ggplot(aes(x= pop_type, y= total, fill=total)) + 
  geom_bar(stat = "identity")  +
  guides(fill=FALSE) +
  theme(axis.text.x = element_text(angle=60, hjust=1)) +
  coord_flip() +
  theme_minimal() +
  facet_wrap(~ continent_res)

# The conclusions are kept: refugees and asylum_seekers were the major types of populations of concern across all continents.

```

We then proceed narrowing down the analysis to Europe, now seeking to relate the distribution of populations of concern across countries. The maps below not only reaffirm the refugee crisis in the Continent (whose populations of concern doubled in the 2000's and from then on steadily increased), but also shows a spread in the destination of these migrants.

```{r, fig.width = 10, fig.height = 5, fig.align="center"}

# Maps of populations of concern per european country of residence 
# Comparison between 1990 and 2016

europe1990 <- pop_time %>% 
  filter(year == 1990, continent_res == "Europe") %>% 
  group_by(country_res) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>% 
  distinct(country_res, total)

map1990 <- joinCountryData2Map(as.data.frame(europe1990), joinCode="NAME", nameJoinColumn="country_res", suggestForFailedCodes=TRUE)

mapCountryData(map1990, nameColumnToPlot="total", catMethod="fixedWidth", 
               mapRegion = "europe", colourPalette="heat",
               mapTitle = "Europe 1990 - Populations of concern")

europe2016 <- pop_time %>% 
  filter(year == 2016, continent_res == "Europe") %>% 
  group_by(country_res) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>% 
  distinct(country_res, total)

map2016 <- joinCountryData2Map(as.data.frame(europe2016), joinCode="NAME", nameJoinColumn="country_res", suggestForFailedCodes=TRUE)

mapCountryData(map2016, nameColumnToPlot="total", catMethod="fixedWidth", 
               mapRegion = "europe", colourPalette="heat", 
               mapTitle = "Europe 2016 - Populations of concern")

```

```{r, include=FALSE}

# A closer look at the evolution of the number of refugees in Europe

pop_time %>% 
  filter(continent_res == "Europe") %>% 
  group_by(year) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  ggplot(aes(x = year, y = total)) +
  geom_line() +
  theme_minimal() 

# How does that look relative to the European countries?

pop_time %>% 
  filter(year > 1999, continent_res == "Europe") %>% 
  group_by(year, country_res) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  ggplot(aes(x = year, y = total, colour=country_res)) +
  geom_line(aes(group = country_res)) +
  theme_minimal() 

# Limiting the analysis so that the caption is easier to read:
# European countries that have received over the last 15 years
# more than 1.000.000 people recorded as populations of concern

pop_time %>% 
  filter(year > 2001, continent_res == "Europe") %>% 
  group_by(year, country_res) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  filter(total  > 1000000) %>% 
  ggplot(aes(x = year, y = total, colour=country_res)) +
  geom_line(aes(group = country_res)) +
  theme_minimal()

```

About 15 years ago, Italy, Sweden and the UK were outstanding as the top migrants' receivers. Recently, France, Germany and the Netherlands were added to the countries that most receive refugees; with many others, such as Belgium, Ireland, Switzerland and Norway being added to the list of European countries that have received over 1 million persons of concern during the last 15 years. Austria is approaching this numbers and Spain, Ireland and Norway were also noticeably affected by this influx of people. 

The time trend perceived here is that the countries which were the biggest receivers of persons of concern 15 years ago keep being so, the reasons for that are not clear by the data though (they could very among countries' policies in relation to refugees, countries' economic situation, etc.). The geographical position, however, is clearly not the (only) explainer, since Italy and UK, for example, are far away from each other and keep being the top receivers of persons of concern.

Our last analysis consisted in verifying if there was any demographic difference among the populations of concern in Europe. Graphing the populations of concern over time per gender and age, it was possible to see that, aside the groups over 60 years old, the persons of concern are more male than female, with the proportions keeping quite constant over time. Among the different age groups, the 18-59 years old is the one that outstandingly included the highest number of persons of concern in all the years analyzed.

Although we can say that refugees are more likely to be between 18 and 59 years old and male, we cannot affirm that being male in this age group leads to higher chances of being a refugee (that would depend on analyzing other variables that are not available in the UNHCR datasets). Nevertheless, as this is a time-trend that stayed constant, there is hint for similar future.


```{r, fig.align="center"}

# Analyzing demographics over time

# As the categories of age were plotted in the wrong order, we corrected the variable:
demo_tidy$age <-  factor(demo_tidy$age, levels=c("0-4", "5-17", "18-59", "over 60"))
demo_tidy$age

demo_tidy %>%
  filter(continent_res == "Europe") %>% 
  group_by(year, age, gender) %>%
  mutate(total = sum(value, na.rm=TRUE)) %>%
  distinct(year, age, total, gender) %>%
  ggplot(aes(x=year, y=total, colour= age)) +
  geom_line(aes(group=age)) +
  theme(axis.text.x = element_text(angle=60, hjust=1)) +
  ggtitle("The age and gender of populations of concern \n in Europe from 2001 to 2016") +
  xlab("Year") +
  ylab("Registered populations of concern") +
  labs(color = "Age groups") +
  theme(plot.title = element_text(size=10, family="Times")) +
  theme_minimal() +
  facet_wrap(~ gender)
```

## 5. In conclusion, which "refugee myths" can we tackle down?

**"This is a migrant crisis, not a refugee crisis" (also in the version "They're not really refugees, but just economic migrants seeking a better life")**

**Myth.** For all the continents analyzed, the refugees were the biggest type of populations of concern - populations which, as shown above, began to grow considerably in the 2000's and had a steady peak in 2015 - meaning that there is indeed a refugee crisis. 

Nevertheless, the second biggest group of populations of concern in all continents were the asylum seekers, those persons who are still waiting to be granted with a refugee status. As these persons might not be considered refugees by the UNHCR after the waiting process, it is unsure whether they will be labeled as refugees or not and, if not, on which grounds (it is possible that they are seen economic migrants, but there can be other reasons, like not observing the bureaucracy involved in the process). As an official measure of accepted requests, the European Commission reported that ca. 60% of the asylum requests were granted in 2016[^5]. Keeping in mind the other 40% and the lack of information on the datasets about the reasons of denial, parsimony is needed in assessing this statement. However, these numbers vary tremendously, and this can be seen in the case of Germany, in the table below tracking the evolution of the accepted applications as a share of the total decisions taken in a given year.

```{r, results='asis'}

library(kableExtra)
asylum_tidy <- asylum_all %>% 
  select(Year, Country...territory.of.asylum.residence, 
                                    statistics.filter.decisions_recognized, Rejected, 
                                    Total.decisions) %>%
  rename(country_res=Country...territory.of.asylum.residence, 
         accepted=statistics.filter.decisions_recognized, rejected=Rejected, 
         decisions=Total.decisions, year=Year)

t <- asylum_tidy %>% 
  filter(country_res=="Germany", as.integer(year) > 2010) %>% 
  group_by(year) %>% 
  mutate(suma=sum(as.numeric(accepted), na.rm=TRUE), 
         sumd=sum(as.numeric(decisions), na.rm=TRUE),
         accepted_ratio=suma/sumd) %>% 
  distinct(year, accepted_ratio)

kable(t, format = "markdown")

```

[^5]: Asylum statistics. Eurostat. Available at: http://ec.europa.eu/eurostat/statistics-explained/index.php/Asylum_statistics. Retrieved 14.12.2017.

$~$

**"Europe is hostile with refugees"**

**Myth.** At least in number of refugees received, the continent is by far the one that receive most refugees over time, achieving 2 billion populations of concern in 2015, which is more than the populations of entire small countries, such as Estonia and Kosovo. Besides, the low numbers of returnees in Europe (lower than in the Americas and Asia), demonstrates that, in fact, a large proportion of refugees that seek the continent are allowed to stay there permanently.

$~$

**"The refugees will steal our jobs" (also in the version "They're mostly men in working age, who would be capable to survive in their home countries")**

**Partially true.** The data analyzed states undeniably that the refugees are mostly men in working age (between 18 and 59 years old). However, this does not automatically imply that the reason why they are displaced is to seek work abroad, neither that the conditions in their origin's country would allow surviving and minimum human life stands. Furthermore, there are many other factors to be considered in judging this statement, as for example the capacitation and education levels of the refugees (data which we do not have); the existence of laws in the country of residence that favor or allow their ingress in the job market (and the contrary); etc. Regarding the data analyzed, affirmations can be done solely about the demographic composition of the refugee population (as seen in the section above), no further assessments can be done.


### Final note: For more detailed time series and demographics trends, explore out interactive dashboard available in the same repository.

\newpage
## References

Asylum statistics. Eurostat. Available at: http://ec.europa.eu/eurostat/statistics-explained/index.php/Asylum_statistics. Retrieved 14.12.2017.

Imdadullah (2013). Time Series Analysis and Forecasting. *In: Basic Statistics and Data Analysis.* Available at: http://itfeature.com/time-series-analysis-and-forecasting/time-series-analysis-forecasting. Retrived 14.12.2017.

Wickham (2014). Tidy Data. *In: Journal of Statistical Software.* Vol. 59, issue 10.

Thomson (2015). 4 myths about refugees - debunked. World Economic Forum. Available at: https://www.weforum.org/agenda/2015/11/4-myths-about-refugees-debunked/. Retrived 14.12.2017.

UNHCR. *Population Statistics*. Data and description available at: http://popstats.unhcr.org/en/overview. Retrived 14.12.2017.

RStudio Blog. Website: https://blog.rstudio.com. Retrived 28.11.2017 - 14.12.2017.

\newpage
# Apendix I - Explanation on tyding process

The demographics dataset as downloaded from the UNHCR website does not follow the principles of a tidy dataset. More specifically, two variables, age and gender, are combined into multiple columns (e.g. Female.0.4, Female.5.11, Male.0.4 etc.), with values being headers. Therefore, we rearranged the information into a column for gender (with the variable values coded as "F" and "M", which we than replaced by "Female" and "Male" to match the rest of the data frame), and one for the age groups (variable name "age"), modifying at the same time the format of the values for better understanding ("0-4", "5-11", "5-17", "12-17", "18-59", "over 60", categories that were later unified and reduced to 5). The tidy dataframe is named "demo_tidy".

The "time_series" dataset provides information about the number of a specific type of population of concerned from a given country of origin located in a country of residence in a given year (from 1951 to 2016). The "resettlement" dataset provides similar information about the resettled populations. Given that the two datasets have the same variables (year, country of residence, country of origin, population type, and value), they can be joined vertically. The joined dataset is "pop_time", with "resettlement" being essentially transformed into additional observations in the "time_series dataset. This operation helps us have information about all populations of concern in one dataset. 

\newpage
# Apendix II - Explanation on the variables

## Variables in "pop_time"

| **Variable**  | **Type**      | **Description**                                                          |
| ------------- | ------------- | ------------------------------------------------------------------------ |
| year          | Categorical/  | Year when data was recorded, from 1951 to 2016                           |
|               | continuous    |                                                                          |
|               |               |                                                                          |
| continent_res | Categorical   | Continent where the persons of concern reside: Americas, Africa,         |
|               |               | Asia, Americas, Africa, Asia, Europe or Oceania                          |
|               |               |                                                                          |
| country_res   | Categorical   | Country where the persons of concern reside, includes 199 countries      |
|               |               |                                                                          |
| origin        | Categorical   | Country or origin of the persons of concern, includes 226 countries      |
|               |               |                                                                          |
| pop_type      | Categorical   | Types of populations of concern: Refugees (incl.refugee-like situations),|
|               |               | Returnees, Asylum-seekers, Stateless, Internally displaced persons,      |
|               |               | Returned IDPs, Resettled or Others of concern.                           |
|               |               |                                                                          |
| value         | Continuous    | Number of persons of concern that fulfill the conditions in a row        |
|               |               | (e.g. the number of refugees from Ghana living in Italy in 1984 was 102) |

## Variables in "demo_tidy"

| **Variable**  | **Type**      | **Description**                                                          |
| ------------- | ------------- | ------------------------------------------------------------------------ |
| year          | Categorical/  | Year when data was recorded, from 2001 to 2016                           |
|               | continuous    |                                                                          |
|               |               |                                                                          |
| continent_res | Categorical   | Continent where the persons of concern reside: Americas, Africa,         |
|               |               | Asia, Americas, Africa, Asia, Europe or Oceania                          |
|               |               |                                                                          |
| country_res   | Categorical   | Country where the persons of concern reside, includes 191 countries      |
|               |               |                                                                          |
| location_res  | Categorical   | Location (city, region, state, province, etc.) where the persons of      | |               |               | concern reside. Includes over 5000 locations, but in some cases is not   | |               |               | specific (e.g. "Russian Federation : Dispersed in the country /territory"|
|               |               | "Various", etc.)                                                         |
|               |               |                                                                          |
| gender        | Categorical   | Gender of the persons of concern (Female or Male)                        |
|               |               |                                                                          |
| age           | Categorical   | Age group of the persons of concern: "0-4", "5-17", "18-59", "over 60"   |
|               |               |                                                                          |
| value         | Continuous    | Number of persons of concern that fulfill the conditions                 |
|               |               | in a row (e.g. the number of female persons of concern,                  |
|               |               | between 0-4 years old,living in Luanda in 2001 was 28)                   |
